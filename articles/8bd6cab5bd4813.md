---
title: "SoundCloudみたいなサービスを個人で開発した"
emoji: "🔊"
type: "tech"
topics: ["nextjs", "個人開発"]
published: false
---

## リンク

https://vvave.app

## スクリーンショット

| プロフィール                                                                   | プロフィール                                                                   | 検索                                                                           | プレイヤー                                                                     |
| ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------ | ------------------------------------------------------------------------------ |
| ![](https://storage.googleapis.com/zenn-user-upload/ad3eee872f02-20240117.png) | ![](https://storage.googleapis.com/zenn-user-upload/c0e097439e2e-20240117.png) | ![](https://storage.googleapis.com/zenn-user-upload/8b252d8f5691-20240117.png) | ![](https://storage.googleapis.com/zenn-user-upload/b68acab13632-20240117.png) |

## サービス概要

タイトル通り、**現状はSoundCloudみたいに自分の作った曲を投稿できるサービス**です。

現在実装されている機能は以下の通りです。

- 楽曲投稿
- アルバム
- ランキング
- メッセージ（DM）
- フォローとフィード（タイムライン）
- いいねとブックマーク
- タグ・キーワードによる検索

このようにとりあえずSoundCloudのような楽曲投稿サービスとしての機能は最低限備えていますが、**ゆくゆくはミュージシャンの活動拠点になることを目指しています**。というのは、例えばYouTubeへの投稿や各種サブスク配信へのリンク、またライブなどイベントへの参加日程など、活動の実績/予定などがすべて1ページでわかるようにしたいと思っています。

また、**ミュージシャン同士の交流/発見の場にしていきたい**です。バンドメンバーや演奏を依頼する相手を見つけるのに適した場所はあまりありません（いわゆるメン募サイトは機能不全だし、Twitterが現実解かもしれないが検索性は高くない）。

というわけで、**実は目指しているものはSoundCloudというよりも、音楽版の** [Dribbble](https://dribbble.com) **や** [Behance](https://behance.net) **です。** さまざまなミュージシャンの才能を集約して検索可能にすることが最大の目標です。

（もちろんX.comのように各ユーザーのページの閲覧のためにログインを強制するつもりは一切ありません。in/outは完全にオープンにします）

## 技術構成

まず技術選定の方針としては**可能な限り無料**を原則としました。現状、費用がかかっているのはVercelのProプランのみで、スケールしない限りは$20/月で運用できます（Vercelは他のプロジェクトとも共用しているので立ち上げに際してコストがかかってるという意識はないです）。

### Next.js (App Router) + Vercel

フレームワークはNext.jsで、Vercelにデプロイしています。

VercelなのでServer ComponentやISR、Server Actionなど最新機能を盛りだくさんで実装しました。それらの使い心地などに関して細かく述べることはしませんが、これによってVercelにロックインされてしまった感はあります。

以前試したときは [Next on Cloudflare Pages](https://github.com/cloudflare/next-on-pages) は（Pages Routerであっても）あまり実用的に動かなかったし、Cloud Runでも全機能が使えるわけではなさそうです。ただ、Vercel Proに含まれている1TBの帯域を超えるほどスケールするには時間がかかるという前提で、とりあえずは最新機能を使ってみました。

### CSS Modules + Camome UI

https://camome.net

スタイリングにはCSS Modulesを使用しています。また、基本的なコンポーネントの基盤として [Camome UI](https://camome.net) を採用しました（といってもこれは僕が開発したライブラリなので採用もクソもないですが）。

CSS Modulesを選んだ理由は、何よりも**最も生のCSSに近い**からです。Server Componentでも使えるスタイリング方法といえばTailwindもありますが、寿命という意味では個人的にちょっと信頼できないと感じています。

Camome UIのコンポーネントをベースにしつつ、その他のUIも [Camome UIのデザイントークン](https://camome.net/ja/docs/design-system/overview) を使ってスタイリングしています。

### Radix UI

Camome UIはHTML/CSS以外は提供しないので、モーダルなどの複雑なUIは [Radix UI](https://www.radix-ui.com) を用いて実装しています。

他にも[Headless UI](https://headlessui.com/)も使ったことがありますが、Radixの方が痒いところに手が届くしスタイリングもしやすいと思います。特に `data-` 属性を使ったアニメーション制御はかなり開発体験がいいです。

### Prisma

ORMには [Prisma](https://prisma.io) を使っています。

有名なライブラリなのでいまさらあまり言及することはないと思います。ひとつだけ不満を述べるとすれば、複雑なクエリを書く際に `$queryRaw` に頼らざるを得ないことが多いということでしょうか。[Drizzle](https://orm.drizzle.team/) はPrisma式のAPIとクエリビルダーの両方をサポートしているようなので、もしかしたらそのあたりはベターだったりするかもしれません（使ったことはないです）。

### Supabase

データベースは [Supabase](https://supabase.com) を生のPostgresとして利用しています。

無料枠でも500MBまで使わせてもらえるので立ち上げには最適だと思います。それに単なるPostgresとして使うのであればロックインされることもないので安心です（無料枠だけ使って他に移行するのもアレですが）。

（マネージドPostgresとして見た際に、NeonやPlanetScaleなどの有料プランと比較して優位性があるかどうかはまだ検討していません。）

### R2

画像や音声ファイルのホスティングには [Cloudflare R2](https://www.cloudflare.com/ja-jp/developer-platform/r2/) を採用しました。

楽曲投稿サービスという特性上、静的ファイルの置き場所の選定はコストに大きな影響を与えます。R2の最大の長所は**エグレス料金ゼロ**、すなわち下りの通信帯域に料金が加算されない点です。また、10GBまでは無料枠に含まれるというのも嬉しいです。

### NextAuth.js

認証基盤は [NextAuth.js](https://next-auth.js.org) です。

外部の認証系SaaSに依存しなくても必要十分な機能とDXを提供してくれる優秀なライブラリです。PrismaAdapterを使えばDBへのアカウントやセッションの保存をいい感じにやってくれます。また、Googleなどの外部IDプロバイダとの連携も簡単です。

ただし、新規ユーザー登録を一時的にブロックする ([issue](https://github.com/nextauthjs/next-auth/issues/8272)) ことが現状できないといった難点もあったりします。

## TODO

- メンバーや依頼の募集
- コラボレーション
- 高度な検索

## まとめ

興味のある方はぜひ登録よろしくお願いします。

https://vvave.app
